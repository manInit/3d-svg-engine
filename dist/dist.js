(()=>{"use strict";var t=function(t){return t*Math.PI/180};const e=function(){function e(e){this.position={x:0,y:0,z:0},this.rotation={ax:0,ay:0,az:0},this.fov=90,this.zFar=1e4,this.speed=5,this.angleSpeed=2,this.speedVec={x:0,y:0,z:0},this.rotateVec={x:0,y:0,z:0},this.maxAngle=70,this.keys={w:!1,s:!1,a:!1,d:!1,left:!1,right:!1};var r=t(this.fov),n=2*this.zFar*Math.tan(r/2);this.z0=this.zFar*e/n,this.setControls()}return e.getInstance=function(t){return e.instance||(e.instance=new e(null!=t?t:500)),e.instance},e.prototype.setSpeed=function(t,e){this.speed=t,this.angleSpeed=e},e.prototype.update=function(){this.updateSpeed(),this.position.x+=this.speedVec.x,this.position.y+=this.speedVec.y,this.position.z+=this.speedVec.z,this.rotation.ax+=this.rotateVec.x,this.rotation.ay+=this.rotateVec.y,(this.rotation.az>-this.maxAngle&&this.rotateVec.z<0||this.rotation.az<this.maxAngle&&this.rotateVec.z>0)&&(this.rotation.az+=this.rotateVec.z)},e.prototype.setControls=function(){var t=this;document.addEventListener("keydown",(function(e){t.keys.w||(t.keys.w="KeyW"===e.code),t.keys.s||(t.keys.s="KeyS"===e.code),t.keys.a||(t.keys.a="KeyA"===e.code),t.keys.d||(t.keys.d="KeyD"===e.code),"ArrowRight"===e.code&&(t.rotateVec.y=t.angleSpeed),"ArrowLeft"===e.code&&(t.rotateVec.y=-t.angleSpeed),"ArrowUp"===e.code&&(t.rotateVec.z=-t.angleSpeed),"ArrowDown"===e.code&&(t.rotateVec.z=t.angleSpeed)})),document.addEventListener("keyup",(function(e){t.keys.w&&"KeyW"===e.code&&(t.keys.w=!1),t.keys.s&&"KeyS"===e.code&&(t.keys.s=!1),t.keys.a&&"KeyA"===e.code&&(t.keys.a=!1),t.keys.d&&"KeyD"===e.code&&(t.keys.d=!1),"ArrowRight"===e.key&&(t.rotateVec.y=0),"ArrowLeft"===e.key&&(t.rotateVec.y=0),"ArrowUp"===e.code&&(t.rotateVec.z=0),"ArrowDown"===e.code&&(t.rotateVec.z=0)}))},e.prototype.updateSpeed=function(){var e={x:0,y:0,z:0};this.keys.w&&(e.x+=this.speed*Math.sin(t(this.rotation.ay)),e.z+=this.speed*Math.cos(t(this.rotation.ay))),this.keys.s&&(e.x+=-this.speed*Math.sin(t(this.rotation.ay)),e.z+=-this.speed*Math.cos(t(this.rotation.ay))),this.keys.a&&(e.x+=-this.speed*Math.cos(t(this.rotation.ay)),e.z+=this.speed*Math.sin(t(this.rotation.ay))),this.keys.d&&(e.x+=this.speed*Math.cos(t(this.rotation.ay)),e.z+=-this.speed*Math.sin(t(this.rotation.ay))),this.speedVec=e},e}();var r=function(){return document.createElementNS("http://www.w3.org/2000/svg","polygon")},n=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");if(!(t instanceof SVGSVGElement))throw new Error("Expected svg root elem");return t},o=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const i=function(){function t(t,e,r){void 0===r&&(r="blue"),this.elem=e,this.root=t,this.elem.setAttribute("fill",r)}return t.prototype.setTexture=function(t){if(t){this.textureUrl=t;var e=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","defs"),r=document.createElementNS("http://www.w3.org/2000/svg","pattern");r.id="img",r.setAttribute("patternContentUnits","objectBoundingBox"),r.setAttribute("height","100%"),r.setAttribute("width","100%"),r.setAttribute("viewBox","0 0 1 1"),r.setAttribute("preserveAspectRatio","xMidYMid slice");var n=document.createElementNS("http://www.w3.org/2000/svg","image");return n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t),n.setAttribute("width","1"),n.setAttribute("height","1"),n.setAttribute("preserveAspectRatio","xMidYMid slice"),r.append(n),e.append(r),e}(this.textureUrl);this.textureElem=e,this.root.prepend(e)}this.elem.setAttribute("fill","url(#img)"),this.textureUrl},t.prototype.setColor=function(t){this.elem.setAttribute("fill",t)},t.prototype.setPoints=function(t,e){var r,n;this.elem.points.clear();try{for(var i=o(t),a=i.next();!a.done;a=i.next()){var s=a.value,l=this.root.createSVGPoint();l.x=s.x,l.y=s.y,e&&(this.root.style.zIndex=Math.ceil(s.z).toString()),this.elem.points.appendItem(l)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},t}();var a=function(){function t(t,e,r){this.points=t,this.polygon=null!=e?e:null,this.color=null!=r?r:null}return t.prototype.render=function(t){void 0===t&&(t=!1);var r=e.getInstance();if(this.renderPipe&&this.polygon){this.color&&!this.polygon.textureUrl&&this.polygon.setColor(this.color);var n=this.renderPipe.render(this.points);if(this.polygon.textureElem)this.polygon.textureElem.querySelector("image").style.transform="rotateY(".concat(r.rotation.ay*Math.PI/180,")");this.polygon.setPoints(n,t)}},t}();const s=a;const l=function(){function r(){}return r.translate=function(t,e,r,n){return{x:t.x+e,y:t.y+r,z:t.z+n}},r.scale=function(t,e,r,n){return{x:t.x*e,y:t.y*r,z:t.z*n}},r.perspective=function(t){var r=e.getInstance().z0;return{x:t.x*r/t.z,y:t.y*r/t.z,z:0}},r.rotateX=function(e,r){var n=t(r);return{x:e.x,y:e.y*Math.cos(n)+e.z*Math.sin(n),z:-e.y*Math.sin(n)+e.z*Math.cos(n)}},r.rotateY=function(e,r){var n=t(r);return{x:e.x*Math.cos(n)-e.z*Math.sin(n),y:e.y,z:e.x*Math.sin(n)+e.z*Math.cos(n)}},r.rotateZ=function(e,r){var n=t(r);return{x:e.x*Math.cos(n)+e.y*Math.sin(n),y:-e.x*Math.sin(n)+e.y*Math.cos(n),z:e.z}},r}();var c=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const y=function(){function t(t,r){this.width=t,this.height=r,this.camera=e.getInstance()}return t.prototype.render=function(t){var e,r,n,o,i,a=[],s=0,y=0;try{for(var h=c(t),u=h.next();!u.done;u=h.next()){var f=u.value;f=this.cameraTranslate(f),(f=this.cameraRotate(f)).z<0||(f.z>this.camera.zFar||(s+=Math.sqrt(Math.pow(f.x,2)+Math.pow(f.y,2)+Math.pow(f.z,2)),y++,f=l.perspective(f),f=this.transformToAxis2D(f),a.push(f)))}}catch(t){e={error:t}}finally{try{u&&!u.done&&(r=h.return)&&r.call(h)}finally{if(e)throw e.error}}i=s/y;try{for(var p=c(a),d=p.next();!d.done;d=p.next()){(f=d.value).z=1/i*1e5}}catch(t){n={error:t}}finally{try{d&&!d.done&&(o=p.return)&&o.call(p)}finally{if(n)throw n.error}}return a},t.prototype.cameraTranslate=function(t){return l.translate(t,-this.camera.position.x,-this.camera.position.y,-this.camera.position.z)},t.prototype.cameraRotate=function(t){return t=l.rotateX(t,this.camera.rotation.ax),t=l.rotateY(t,this.camera.rotation.ay),l.rotateX(t,this.camera.rotation.az)},t.prototype.transformToAxis2D=function(t){return t=l.scale(t,1,-1,1),t=l.translate(t,this.width/2,this.height/2,0)},t}();var h,u=(h=function(t,e){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},h(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),f=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.render=function(t){var e,r,n=[];try{for(var o=f(t),i=o.next();!i.done;i=o.next()){var a=i.value;a=l.scale(a,.1,.1,.1),a=this.transformToAxis2D(a),n.push(a)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return n},e}(y);var d=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},x=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},v=function(){function t(t,n,o,a){var l,c,y,h,u=function(t){var e=document.getElementById(t);if(!(e instanceof SVGSVGElement))throw new Error("Expected svg root elem");return e}(t);u.style.width="".concat(n,"px"),u.style.height="".concat(o,"px"),this.renderPipe=new p(n,o),this.camera=e.getInstance(),this.world=a,this.objects=[],this.cameraObject=(l=0,c=0,y=3,(h=document.createElementNS("http://www.w3.org/2000/svg","circle")).setAttribute("cx",l.toString()),h.setAttribute("cy",c.toString()),h.setAttribute("r",y.toString()),h),u.append(this.cameraObject);var f=r();u.append(f);var d=new i(u,f);this.cameraDirection=new s([],d),this.cameraDirection.renderPipe=this.renderPipe;for(var x=0;x<this.world.getObjects().length;x++){var v=r();u.append(v);var w=new i(u,v);this.objects.push(new s([],w))}}return t.prototype.render=function(){var t,e,r,n;this.updateRenderPipe();try{for(var o=d(this.world.getObjects().entries()),i=o.next();!i.done;i=o.next()){var a=x(i.value,2),s=a[0],l=a[1],c=[];try{for(var y=(r=void 0,d(l.points)),h=y.next();!h.done;h=y.next()){var u=h.value;c.push({x:u.x,y:u.z,z:0})}}catch(t){r={error:t}}finally{try{h&&!h.done&&(n=y.return)&&n.call(y)}finally{if(r)throw r.error}}this.objects[s].color=l.color,this.objects[s].points=c,this.objects[s].render()}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}this.renderCamera()},t.prototype.renderCamera=function(){this.renderCameraPoint(),this.renderCameraDirection()},t.prototype.renderCameraDirection=function(){for(var t=l.translate(this.camera.position,-this.camera.position.x,-this.camera.position.y,-this.camera.position.z),e=[{x:t.x,y:t.y,z:t.z},{x:t.x,y:t.y,z:t.z+200}],r=0;r<e.length;r++)e[r]=l.rotateX(e[r],-this.camera.rotation.ax),e[r]=l.rotateY(e[r],-this.camera.rotation.ay),e[r]=l.rotateZ(e[r],-this.camera.rotation.az),e[r]=l.translate(e[r],this.camera.position.x,this.camera.position.y,this.camera.position.z),e[r].y=e[r].z;this.cameraDirection.points=e,this.cameraDirection.render()},t.prototype.renderCameraPoint=function(){var t=l.translate(this.camera.position,0,0,0);t.y=t.z;var e=this.renderPipe.render([t])[0];this.cameraObject.setAttribute("cx",e.x.toString()),this.cameraObject.setAttribute("cy",e.y.toString())},t.prototype.updateRenderPipe=function(){var t,e;try{for(var r=d(this.objects),n=r.next();!n.done;n=r.next()){n.value.renderPipe=this.renderPipe}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t}();const w=v;var m=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},z=function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},b=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},g=function(){function t(t,e,r,n){var o=document.getElementById(t);this.worldRoot=o,this.renderPipe=new y(e,r),this.objects=n,this.setPolygonsToObjects(this.objects),this.updateRenderPipe()}return t.prototype.addObject=function(t){var e;this.setPolygonsToObjects(t),(e=this.objects).push.apply(e,z([],m(t),!1)),this.updateRenderPipe()},t.prototype.getObjects=function(){return this.objects},t.prototype.getRenderPipe=function(){return this.renderPipe},t.prototype.render=function(){var t,e;this.updateRenderPipe();try{for(var r=b(this.objects),n=r.next();!n.done;n=r.next()){n.value.render(!0)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setPolygonsToObjects=function(t){var e,o;try{for(var a=b(t),s=a.next();!s.done;s=a.next()){var l=s.value,c=n();this.worldRoot.append(c);var y=r();c.append(y);var h=new i(c,y);l.polygon=h}}catch(t){e={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(e)throw e.error}}t[0].polygon.setTexture("./textures/brick.png")},t.prototype.updateRenderPipe=function(){var t,e;try{for(var r=b(this.objects),n=r.next();!n.done;n=r.next()){n.value.renderPipe=this.renderPipe}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t}();const S=g;var A=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const j=function(){function t(t,e,r,n,o){var i,a;this.sides=[new s([{x:-t/2,y:-t/2,z:-t/2},{x:t/2,y:-t/2,z:-t/2},{x:t/2,y:t/2,z:-t/2},{x:-t/2,y:t/2,z:-t/2}]),new s([{x:-t/2,y:-t/2,z:t/2},{x:t/2,y:-t/2,z:t/2},{x:t/2,y:t/2,z:t/2},{x:-t/2,y:t/2,z:t/2}]),new s([{x:-t/2,y:t/2,z:-t/2},{x:t/2,y:t/2,z:-t/2},{x:t/2,y:t/2,z:t/2},{x:-t/2,y:t/2,z:t/2}]),new s([{x:-t/2,y:-t/2,z:-t/2},{x:t/2,y:-t/2,z:-t/2},{x:t/2,y:-t/2,z:t/2},{x:-t/2,y:-t/2,z:t/2}]),new s([{x:t/2,y:-t/2,z:-t/2},{x:t/2,y:-t/2,z:t/2},{x:t/2,y:t/2,z:t/2},{x:t/2,y:t/2,z:-t/2}]),new s([{x:-t/2,y:-t/2,z:-t/2},{x:-t/2,y:-t/2,z:t/2},{x:-t/2,y:t/2,z:t/2},{x:-t/2,y:t/2,z:-t/2}])];try{for(var l=A(this.sides),c=l.next();!c.done;c=l.next()){c.value.color=e}}catch(t){i={error:t}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}this.translate(r,n,o)}return t.prototype.translate=function(t,e,r){var n,o;try{for(var i=A(this.sides),a=i.next();!a.done;a=i.next())for(var s=a.value,c=0;c<s.points.length;c++)s.points[c]=l.translate(s.points[c],t,e,r)}catch(t){n={error:t}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}},t.prototype.rotate=function(){var t,e;try{for(var r=A(this.sides),n=r.next();!n.done;n=r.next())for(var o=n.value,i=0;i<o.points.length;i++)o.points[i]=l.rotateY(o.points[i],1)}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t}();var M=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const P=function(){function t(t,e,r,n,o,i){var a,l;this.sides=[new s([{x:-t,y:-e,z:-t},{x:t,y:-e,z:-t},{x:t,y:-e,z:t},{x:-t,y:-e,z:t}])];try{for(var c=M(this.sides),y=c.next();!y.done;y=c.next()){y.value.color=r}}catch(t){a={error:t}}finally{try{y&&!y.done&&(l=c.return)&&l.call(c)}finally{if(a)throw a.error}}this.translate(n,o,i)}return t.prototype.translate=function(t,e,r){var n,o;try{for(var i=M(this.sides),a=i.next();!a.done;a=i.next())for(var s=a.value,c=0;c<s.points.length;c++)s.points[c]=l.translate(s.points[c],t,e,r)}catch(t){n={error:t}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}},t}();var k=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const E=function(){function t(t,e,r,n,o){var i,a;this.sides=[new s([{x:-t/2,y:-t/2,z:-t/2},{x:t/2,y:-t/2,z:-t/2},{x:t/2,y:-t/2,z:t/2},{x:-t/2,y:-t/2,z:t/2}]),new s([{x:t/2,y:-t/2,z:-t/2},{x:t/2,y:-t/2,z:t/2},{x:0,y:t/2,z:0}]),new s([{x:-t/2,y:-t/2,z:-t/2},{x:-t/2,y:-t/2,z:t/2},{x:0,y:t/2,z:0}]),new s([{x:-t/2,y:-t/2,z:t/2},{x:t/2,y:-t/2,z:t/2},{x:0,y:t/2,z:0}]),new s([{x:-t/2,y:-t/2,z:-t/2},{x:t/2,y:-t/2,z:-t/2},{x:0,y:t/2,z:0}])];try{for(var l=k(this.sides),c=l.next();!c.done;c=l.next()){c.value.color=e}}catch(t){i={error:t}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}this.translate(r,n,o),this.translatex={x:r,y:n,z:o}}return t.prototype.translate=function(t,e,r){var n,o;try{for(var i=k(this.sides),a=i.next();!a.done;a=i.next())for(var s=a.value,c=0;c<s.points.length;c++)s.points[c]=l.translate(s.points[c],t,e,r)}catch(t){n={error:t}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}},t.prototype.rotate=function(){var t,e;try{for(var r=k(this.sides),n=r.next();!n.done;n=r.next())for(var o=n.value,i=0;i<o.points.length;i++)o.points[i]=l.translate(o.points[i],-this.translatex.x,-this.translatex.y,-this.translatex.z),o.points[i]=l.rotateY(o.points[i],-4),o.points[i]=l.translate(o.points[i],this.translatex.x,this.translatex.y,this.translatex.z)}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t}();var O=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},V=function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},T=new j(100,"black",0,0,0),R=new E(100,"red",0,0,200),D=new E(300,"yellow",300,0,-100),C=new E(250,"green",-1e3,0,350),I=new P(1e3,300,"blue",-1e3,0,-1e3),K=V(V(V(V(V([],O(T.sides),!1),O(R.sides),!1),O(D.sides),!1),O(C.sides),!1),O(I.sides),!1),Y=e.getInstance(window.innerWidth);Y.position={x:-100,y:0,z:-200};var _=new S("world",window.innerWidth,window.innerHeight,K),N=new w("map",200,200,_);requestAnimationFrame((function t(){_.render(),N.render(),Y.update(),R.rotate(),requestAnimationFrame(t)}))})();